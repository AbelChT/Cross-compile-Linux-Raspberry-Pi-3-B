wget -O workspace/sources/busybox-1.31.1.tar.bz2 https://busybox.net/downloads/busybox-1.31.1.tar.bz2
tar -xvjf workspace/sources/busybox-1.31.1.tar.bz2 -C workspace/sources/


make -j${NUM_CPUS} ARCH=arm64 CROSS_COMPILE=$ARCH64_LINUX_CC SYSROOT=$RPI_FILE_TREE_DIR/rootfs STATIC=y clean -C workspace/sources/busybox-1.31.1/
make -j${NUM_CPUS} ARCH=arm64 CROSS_COMPILE=$ARCH64_LINUX_CC SYSROOT=$RPI_FILE_TREE_DIR/rootfs STATIC=y defconfig -C workspace/sources/busybox-1.31.1/
make -j${NUM_CPUS} ARCH=arm64 CROSS_COMPILE=$ARCH64_LINUX_CC SYSROOT=$RPI_FILE_TREE_DIR/rootfs STATIC=y install -C workspace/sources/busybox-1.31.1/

cp -a -r workspace/sources/busybox-1.31.1/_install/* $RPI_FILE_TREE_DIR/rootfs




mkdir -p $RPI_FILE_TREE_DIR/rootfs/{proc,sys,etc,dev}

cat << EOF >> $RPI_FILE_TREE_DIR/rootfs/etc/inittab
::sysinit:/etc/init.d/rcS
tty1::askfirst:/bin/sh
::ctrlaltdel:/sbin/reboot
::shutdown:/sbin/swapoff -a
::shutdown:/bin/umount -a -r
::restart:/sbin/init
tty2::askfirst:/bin/sh
tty3::askfirst:/bin/sh
tty4::askfirst:/bin/sh
EOF

mkdir -p $RPI_FILE_TREE_DIR/rootfs/etc/init.d/

cat << EOF >> $RPI_FILE_TREE_DIR/rootfs/etc/init.d/rcS
#!/bin/sh

if test -f "/dev/console"; then
    mknod -m 600 /dev/console c 5 1
    mknod -m 666 /dev/null c 1 3
fi

mount -t proc nodev /proc
mount -t sysfs nodev /sys
LD_LIBRARY_PATH=/lib:/$LD_LIBRARY_PATH
export LD_LIBRARY_PATH
EOF

cat > $RPI_FILE_TREE_DIR/rootfs/etc/passwd << "EOF"
root:x:0:0:root:/root:/bin/bash
EOF